/*read("fields-5.gp");
d = 5;

The above should be changed, depending on what degree is being looked at. The file above should
consist of appropriate output from the website lmfdb.org.
*/


{
compute_res_inner(f, f_disc, d_local) =
  L = lfuncreate(f);
  l2 = lfun(L, 2);
  l1 = lfunrootres(L)[1];
  l1/(l2 * 2^d_local * f_disc^2);
}

{
compute_res_2(n) = 
  running = 0;
  results = vector(n);
  discs_count = 0;
  for (i = 2, 4*n,
    if (isfundamental(i),
       discs_count = discs_count + 1;
       running = running + compute_res_inner(x^2 - i, i, 2);
       results[discs_count] = running;
    );
    if (discs_count == n, i = 4*n); \\ shortcut the loop
  );
  running;
}

\\ startval = 1: This is a default. Set to something else to not start from the beginning.
{
compute_res(n, startval = 1) = 
  running = vector(10);  
  discs_count = 0;
  discs_count_galois = vector(10);
  results = matrix(10, n);
  for (i = 1, n,
    f = data[i][1];
    disc = data[i][2];
    galois_type = data[i][3];
    if (i >= startval,
      running[galois_type] = running[galois_type] + compute_res_inner(f, disc, d));
    discs_count++;
    discs_count_galois[galois_type]++;
    results[galois_type, discs_count_galois[galois_type]] = running[galois_type];
  );
  running;
}

{
foo(n, m = 0) = 
  print(m);
}

cr = compute_res;

\\print(foo(100));
\\print(foo(1000));

/*
Results of running the program:

2:

n = 100:
0.0096894170524844683032255143335449366414

n = 1000:
0.0098382270347653828579103221368321712920

8000:
0.0098534790039597190288298178404859313494

10000:
0.0098539195041398164918161227189987950121

80000:
0.0098554660019993818089177872647588229355

100000:
0.0098555103389218188156927050385470977717

113727: (this is where I pulled the plug; the computation had taken nine hours)
0.0098555317467324919523032544507610882032

For 3 and on, we get a vector (the contribution of each Galois type is enumerated separately)

3:
n = 100:
[2.2837351692632073295466947814629036671 E-5, 9.0456648943862527170251422073047844213 E-6, 0, 0, 0, 0, 0, 0, 0, 0]
Total: 3.1883016587018326012492090021933821086 E-5

n = 1000:
[2.2869245766850169111149986902822194161 E-5, 9.9506073374972688999155483873895921872 E-6, 0, 0, 0, 0, 0, 0, 0, 0]
Total: 3.2819853104347438011065535290211786284 E-5

n = 25000:
[2.2870491962720756256563696444950381079 E-5, 1.0140888718052809072161578127168525593 E-5, 0, 0, 0, 0, 0, 0, 0, 0]
Total: 3.3011380680773565328725274572118906672 E-5

Galois groups:
[107, 24893, 0, 0, 0, 0, 0, 0, 0, 0]
? results[1, 107]
%43 = 2.2870491962720756256563696444950381079 E-5
? results[1, 100]
%44 = 2.2870487167517110393123382533681836070 E-5
? results[1, 30]
%45 = 2.2869822959322289371469025979452623685 E-5
? results[2, 24892]
%49 = 1.0140888210781958239166663016298363300 E-5
? results[2, 24800]
%50 = 1.0140844220302003230991522944402854914 E-5
? results[2, 24000]
%51 = 1.0140445215151759564197180685350249822 E-5
? results[2, 16000]
%52 = 1.0134502555162689581699677453870599264 E-5

4:
n = 100:
1.0789556919622977971489661816984117027 E-7

n = 1000:
1.2008819111294208283733441601081118567 E-7

n = 25000:
discriminant range: 1-1771660

[2.4121602930327586564610549388685134927 E-8, 1.5608749083733693421785415333045949934 E-8, 5.9119827918221831938659336617531980781 E-8, 9.2892869582799515610462530472894285148 E-11, 2.4850585583574072692456300927800213771 E-8, 0, 0, 0, 0, 0]
Total: 1.2379365838543998413312206479753617370 E-7

Galois groups: [75, 289, 8147, 45, 16444, 0, 0, 0, 0, 0]

? results[1, 75]
%6 = 2.4121602930327586564610549388685134927 E-8
? results[1, 50]
%7 = 2.4120929079840841805000674749911865052 E-8
? results[2, 289]
%8 = 1.5608749083733693421785415333045949934 E-8
? results[2, 200]
%9 = 1.5606818463670994209258423907280470568 E-8
? results[3, 8147]
%10 = 5.9119827918221831938659336617531980781 E-8
? results[3, 6000]
%11 = 5.9089702480428601721743222768721537103 E-8
? results[4, 45]
%12 = 9.2892869582799515610462530472894285148 E-11
? results[4, 30]
%13 = 9.2453462910976583891588081531408068007 E-11
? results[5, 16444]
%14 = 2.4850585583574072692456300927800213771 E-8
? results[5, 12000]
%15 = 2.4769847140650465429456345652739685036 E-8



5:
discriminant range 1-21591000

8.3520907147227818059023614898508624585 E-11
9.7477638348892849376051695607108384647 E-11

cr(5000)
%14 = [3.0846481057363350435477044030318395121 E-11, 4.2218987959706809702665651176086028486 E-13, 6.9449594310040638054712715096000332046 E-15, 2.2410848709735277934978416845543438589 E-15, 7.1195004172294712753097050282504297071 E-11, 0, 0, 0, 0, 0]
? discs_count_galois
%15 = [4, 11, 3, 2, 4980, 0, 0, 0, 0, 0]

? cr(10000, 5001)
%16 = [0, 8.0869156813679883397097681107563695267 E-16, 1.6488519027078916037182684309139390439 E-15, 1.7313081718693322671960589404685871769 E-15, 1.3023604643423075512675543135031403738 E-12, 0, 0, 0, 0, 0]
? discs_count_galois
%17 = [4, 15, 8, 7, 9966, 0, 0, 0, 0, 0]

? cr(15000, 10001)
%18 = [6.0511106309801544423778955095024132420 E-17, 3.5557062508417241698411929721513380506 E-16, 2.4870914034459371153929616701764262551 E-16, 5.6693362401390929851908557769748505770 E-16, 5.8654423272631659837139743239423441988 E-13, 0, 0, 0, 0, 0]
? discs_count_galois
%19 = [5, 18, 10, 12, 14955, 0, 0, 0, 0, 0]

? cr(20000, 15001)
%20 = [0, 2.3599030967574174488562964541188272770 E-16, 1.6304251482703462562768149702261704765 E-16, 2.5637954161572556895482603043818797986 E-16, 3.5192994124992008825444383475846335874 E-13, 0, 0, 0, 0, 0]
? discs_count_galois
%21 = [5, 21, 12, 16, 19946, 0, 0, 0, 0, 0]

? cr(22000, 20001)
%22 = [0, 1.2888863154713708090680287140312183826 E-16, 5.0076016379724880661587633459658559024 E-17, 1.1014488650612442108175796848510043733 E-16, 1.0385633991020740786529196081561366206 E-13, 0, 0, 0, 0, 0]
? discs_count_galois
%23 = [5, 24, 13, 18, 21940, 0, 0, 0, 0, 0]

cr(24000, 22001)
%24 = [0, 1.4781550782844024221051739828149362166 E-16, 8.5730692239191989944615021396204752542 E-17, 1.8600561110374619329568535713019688258 E-17, 9.2034153808948362323438021781299840055 E-14, 0, 0, 0, 0, 0]
? discs_count_galois
%25 = [5, 27, 15, 19, 23934, 0, 0, 0, 0, 0]

? cr(25000, 24001)
%26 = [0, 3.1994738320029090878572122278324162652 E-17, 0, 7.2333288310101027728167661948204270454 E-17, 4.1929010137406393539075896531644155825 E-14, 0, 0, 0, 0, 0]
? discs_count_galois
%27 = [5, 28, 15, 21, 24931, 0, 0, 0, 0, 0]

TOTALS:
? %14 + %16 + %18 + %20 + %22 + %24 + %26
%35 = [3.0846541568469660237021467809273490145 E-11, 4.2389883097766041643649312990652587796 E-13, 9.1413696975025006169627202594100952331 E-15, 4.9967849443990949963073063993049284693 E-15, 7.3673658314469819154718251742288692880 E-11, 0, 0, 0, 0, 0]
? sum(i = 1, 10, %35[i])
%36 = 1.0495823686855904140378948270812742393 E-10

6: 
2.1718062798687526670056656635353108696 E-13
2.6539217410146634639889926300845607871 E-13


*/